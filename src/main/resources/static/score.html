<!DOCTYPE html>
<html lang="en">
<style>
    @import url(https://fonts.googleapis.com/css?family=Open+Sans:300,400,700&display=swap);
</style>
<head>
    <link href="styles.css" rel="stylesheet">
    <title>Pub Golf - Submit Score</title>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        function submitScore() {
            $.ajax({
                url: '/api/v1/score',
                type: 'post',
                data: $('#pubgolf-score').serialize(),
                success: function () {
                    document.location.href = "/";
                },
                error: function () {
                    alert("Error submitting score, please check input and try again.")
                }
            });
        }
    </script>
    <script>
        function checkName() {
           let name = localStorage.getItem("name");
            if (!name | name === 'null') {
                name =  prompt("Please enter your name", "");
                localStorage.setItem("name", name);
            }
            document.getElementById("name").value = name;
        }
    </script>
    <script>
        function resetName() {
            $.ajax({
                url: '/api/v1/score?name=' + localStorage.getItem("name"),
                type: 'delete',
                success: function () {
                   localStorage.setItem("name", "null");
                   checkName();
                },
                error: function () {
                    alert("Error resetting name, please check network and try again.")
                }
            });
        }
    </script>

</head>

<body onload="checkName();">
<div class="flex-container">
    <div class="container">
        <form id="pubgolf-score">
            <h3><a href='/'>Pub Golf</a></h3>
            <h4>Submit your score:</h4>

            <fieldset>
                <input id="name" placeholder="Name" type="text" tabindex="0" name="name" required readonly>
            </fieldset>

            <select id="hole" name="hole" tabindex="1" required autofocus>
                <option value="" disabled selected hidden>Hole</option>
                <option value="1">1 - Par 1</option>
                <option value="2">2 - Par 3</option>
                <option value="3">3 - Par 2</option>
                <option value="4">4 - Par 2</option>
                <option value="5">5 - Par 2</option>
                <option value="6">6 - Par 2</option>
                <option value="7">7 - Par 4</option>
                <option value="8">8 - Par 1</option>
                <option value="9">9 - Par 1</option>
            </select>

            <fieldset>
                <input id="par" placeholder="Score" type="number" tabindex="0" name="par" required>
            </fieldset>

            <fieldset>
                <button type="button" onclick="submitScore();">Submit</button>
            </fieldset>

            <fieldset>
                <button type="button" onclick="resetName();">Reset Name</button>
            </fieldset>
        </form>
    </div>
</div>
</body>
</html>
